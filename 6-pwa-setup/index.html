<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6. Showing the install button prompt | PWA Workshop</title>
    <meta name="description" content="Introduction to Progressive Web Applications">
    <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PWA Workshop Docs">
  <meta name="apple-mobile-web-app-title" content="PWA Workshop Docs">
    
    <link rel="preload" href="/assets/css/0.styles.aa2ecf69.css" as="style"><link rel="preload" href="/assets/js/app.d9dc9a76.js" as="script"><link rel="preload" href="/assets/js/3.c69d9a44.js" as="script"><link rel="preload" href="/assets/js/9.363b16b9.js" as="script"><link rel="prefetch" href="/assets/js/1.70248c23.js"><link rel="prefetch" href="/assets/js/10.4a2f255d.js"><link rel="prefetch" href="/assets/js/11.27680d75.js"><link rel="prefetch" href="/assets/js/12.3eef7c77.js"><link rel="prefetch" href="/assets/js/13.7f52cf31.js"><link rel="prefetch" href="/assets/js/14.375a1e21.js"><link rel="prefetch" href="/assets/js/15.349dce31.js"><link rel="prefetch" href="/assets/js/16.5c7d3d8b.js"><link rel="prefetch" href="/assets/js/17.b0821c4d.js"><link rel="prefetch" href="/assets/js/18.b5485965.js"><link rel="prefetch" href="/assets/js/19.f2ff2149.js"><link rel="prefetch" href="/assets/js/20.2fc7ff0c.js"><link rel="prefetch" href="/assets/js/21.02740876.js"><link rel="prefetch" href="/assets/js/22.6ed05f9f.js"><link rel="prefetch" href="/assets/js/23.cb63fa5d.js"><link rel="prefetch" href="/assets/js/24.e5dfe154.js"><link rel="prefetch" href="/assets/js/4.15820eac.js"><link rel="prefetch" href="/assets/js/5.fba207a2.js"><link rel="prefetch" href="/assets/js/6.e17a1400.js"><link rel="prefetch" href="/assets/js/7.a2e3be9a.js"><link rel="prefetch" href="/assets/js/8.8f8d29be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aa2ecf69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">PWA Workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/6-pwa-setup/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/fr/6-pwa-setup/" class="nav-link">Français</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/6-pwa-setup/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/fr/6-pwa-setup/" class="nav-link">Français</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Introduction</a></li><li><a href="/1-manifest/" class="sidebar-link">1. Adding a Web App Manifest</a></li><li><a href="/2-service-worker/" class="sidebar-link">2. Install a Service Worker</a></li><li><a href="/3-precaching/" class="sidebar-link">3. Precaching and basic offline mode</a></li><li><a href="/4-api-cache/" class="sidebar-link">4. Cache Strategy for REST API</a></li><li><a href="/5-background-sync/" class="sidebar-link">5. Background sync and notifications</a></li><li><a href="/6-pwa-setup/" class="active sidebar-link">6. Showing the install button prompt</a></li><li><a href="/finish.html" class="sidebar-link">To go further</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="step-6-showing-the-install-button-prompt"><a href="#step-6-showing-the-install-button-prompt" class="header-anchor">#</a> Step 6 : Showing the install button prompt</h1> <p>One of the advantages of PWA is that they can be installed if they respect certain criteria which depend on the browser. Here are the criteria for <a href="https://developers.google.com/web/fundamentals/app-install-banners/#criteria" target="_blank" rel="noopener noreferrer">Chrome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <ul><li>The web app is not already installed.
<ul><li>and prefer_related_applications is not true.</li></ul></li> <li>Meets a user engagement heuristic (currently, the user has interacted with the domain for at least 30 seconds)</li> <li>Includes a web app manifest that includes:
<ul><li>short_name or name</li> <li>icons must include a 192px and a 512px sized icons</li> <li>start_url</li> <li>display must be one of: fullscreen, standalone, or minimal-ui</li></ul></li> <li>Served over HTTPS (required for service workers)</li> <li>Has registered a service worker with a fetch event handler</li></ul> <p>Originally, the browser handled all the steps related to installation from the presentation of the banner to the addition of the app icon to the homescreen.
However, it is now possible for the app to handle the presentation of the UI that leads to the PWA install prompt.
In this case, the browser manages whether we should display that button and the presentation of the prompt.
The app should verify if it can present a setup UI by listening to the  and ask the browser to show the popup of the user requests it.</p> <p>Let's add an <strong>install</strong> to our PWA by following these steps:</p> <ul><li>Set the property <a href="https://developers.google.com/web/fundamentals/app-install-banners/native#prefer_related_applications" target="_blank" rel="noopener noreferrer">prefer_related_applications<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to <code>false</code> in the manifest file.</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;prefer_related_applications&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Add a button somewhere in your page and hide it by default</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>setup_button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>installApp()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Installer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#setup_button</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>In the main JavaScript file, intercept the <code>beforeinstallprompt</code> event which is fired when the PWA meets to install criteria. In this event event handler, we need to keep a reference to the event and show the setup button.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> deferredPrompt<span class="token punctuation">;</span> <span class="token comment">// Allows to show the install prompt</span>
<span class="token keyword">let</span> setupButton<span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeinstallprompt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prevent Chrome 67 and earlier from automatically showing the prompt</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Stash the event so it can be triggered later.</span>
    deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeinstallprompt fired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>setupButton <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        setupButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;setup_button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Show the setup button</span>
    setupButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;inline&quot;</span><span class="token punctuation">;</span>
    setupButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>In the <code>installApp()</code> function, show the setup prompt.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">installApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Show the prompt</span>
    deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    setupButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Wait for the user to respond to the prompt</span>
    deferredPrompt<span class="token punctuation">.</span>userChoice
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">'accepted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PWA setup accepted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// hide our user interface that shows our A2HS button</span>
                setupButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PWA setup rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Optionally, we can listen for the app installed event to perform any additional setup when the install finished</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'appinstalled'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;appinstalled fired&quot;</span><span class="token punctuation">,</span> evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now's the time to test. Don't hesitate to reload the page by clearing the cache. In macOS, the shortcut is <strong>⇧⌘R</strong></p> <p><img src="/assets/img/pwa_setup_button.1a13ee70.png" alt="PWA install button"> <img src="/assets/img/pwa_setup_prompt.4b3c7ae2.png" alt="PWA install prompt"></p> <p>Here is how an installed PWA looks on macOS</p> <p><img src="/assets/img/pwa_installed.7df4c154.png" alt="PWA installed"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/5-background-sync/" class="prev">5. Background sync and notifications</a></span> <span class="next"><a href="/finish.html">To go further</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d9dc9a76.js" defer></script><script src="/assets/js/3.c69d9a44.js" defer></script><script src="/assets/js/9.363b16b9.js" defer></script>
  </body>
</html>
