<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6. Présentation de l&#39;invite d&#39;installation | PWA Workshop</title>
    <meta name="description" content="Introduction aux Progressive Web Applications">
    <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PWA Workshop Docs">
  <meta name="apple-mobile-web-app-title" content="PWA Workshop Docs">
    
    <link rel="preload" href="/assets/css/0.styles.aa2ecf69.css" as="style"><link rel="preload" href="/assets/js/app.d9dc9a76.js" as="script"><link rel="preload" href="/assets/js/3.c69d9a44.js" as="script"><link rel="preload" href="/assets/js/10.4a2f255d.js" as="script"><link rel="prefetch" href="/assets/js/1.70248c23.js"><link rel="prefetch" href="/assets/js/11.27680d75.js"><link rel="prefetch" href="/assets/js/12.3eef7c77.js"><link rel="prefetch" href="/assets/js/13.7f52cf31.js"><link rel="prefetch" href="/assets/js/14.375a1e21.js"><link rel="prefetch" href="/assets/js/15.349dce31.js"><link rel="prefetch" href="/assets/js/16.5c7d3d8b.js"><link rel="prefetch" href="/assets/js/17.b0821c4d.js"><link rel="prefetch" href="/assets/js/18.b5485965.js"><link rel="prefetch" href="/assets/js/19.f2ff2149.js"><link rel="prefetch" href="/assets/js/20.2fc7ff0c.js"><link rel="prefetch" href="/assets/js/21.02740876.js"><link rel="prefetch" href="/assets/js/22.6ed05f9f.js"><link rel="prefetch" href="/assets/js/23.cb63fa5d.js"><link rel="prefetch" href="/assets/js/24.e5dfe154.js"><link rel="prefetch" href="/assets/js/4.15820eac.js"><link rel="prefetch" href="/assets/js/5.fba207a2.js"><link rel="prefetch" href="/assets/js/6.e17a1400.js"><link rel="prefetch" href="/assets/js/7.a2e3be9a.js"><link rel="prefetch" href="/assets/js/8.8f8d29be.js"><link rel="prefetch" href="/assets/js/9.363b16b9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aa2ecf69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fr/" class="home-link router-link-active"><!----> <span class="site-name">PWA Workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Langue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/6-pwa-setup/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/fr/6-pwa-setup/" class="nav-link router-link-exact-active router-link-active">Français</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Langue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/6-pwa-setup/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/fr/6-pwa-setup/" class="nav-link router-link-exact-active router-link-active">Français</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fr/" class="sidebar-link">Introduction</a></li><li><a href="/fr/1-manifest/" class="sidebar-link">1. Ajout d'un Web App Manifest</a></li><li><a href="/fr/2-service-worker/" class="sidebar-link">2. Installation d'un Service Worker</a></li><li><a href="/fr/3-precaching/" class="sidebar-link">3. Precaching et mode offline basique</a></li><li><a href="/fr/4-api-cache/" class="sidebar-link">4. Stratégie de Cache pour API REST</a></li><li><a href="/fr/5-background-sync/" class="sidebar-link">5. Background sync et notifications</a></li><li><a href="/fr/6-pwa-setup/" class="active sidebar-link">6. Présentation de l'invite d'installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fr/6-pwa-setup/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/fr/6-pwa-setup/#partie-pratique" class="sidebar-link">Partie pratique</a></li></ul></li><li><a href="/fr/finish.html" class="sidebar-link">Pour aller plus loin</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Un des avantages des PWA est qu’ils peuvent être installés s’ils respectent certains critères. Ce derniers dépendent du navigateur utilisé. Voici, à titre d'exemple, les critères si [Chrome] (https://developers.google.com/web/fundamentals/app-install-banners/#criteria):</p> <ul><li>L'application Web n'est pas déjà installée.
<ul><li>et <code>prefer_related_applications</code> vaut <code>false</code>.</li></ul></li> <li>Rencontre une heuristique d'engagement de l'utilisateur (actuellement, l'utilisateur a interagi avec le domaine pendant au moins 30 secondes)</li> <li>Comprend un manifeste d'applications Web comprenant:
<ul><li>short_name ou name</li> <li>les icônes doivent inclure des icônes de 192px et 512px</li> <li>start_url</li> <li>l'affichage doit être l'un des suivants: fullscreen, standalone ou minimal-ui</li></ul></li> <li>Servi sur HTTPS (obligatoire pour les agents de service)</li> <li>A inscrit un technicien de service avec un gestionnaire d'événements fetch</li></ul> <p>À l'origine, le navigateur gérait toutes les étapes liées à l'installation, de la présentation de la bannière à l'ajout de l'icône de l'application à l'écran d'accueil.
Cependant, il est maintenant possible pour de gérer la présentation de l'interface utilisateur menant à l'invite d'installation de la PWA.
Dans ce cas, le navigateur détermine s'il convient d'afficher ce bouton et en informe l'application par le biais de l'évènement <code>beforeinstallprompt</code>.
L'application doit vérifier si elle peut présenter une interface utilisateur de configuration en écoutant la et demander au navigateur d'afficher l'invite d'installation.
Le navigateur se charge ensuite du déroulement de l'installation. L'application peut cependant savoir si l'utilisateur a validé l'invite et si l'installation s'set achevée avec succès.</p> <h2 id="partie-pratique"><a href="#partie-pratique" class="header-anchor">#</a> Partie pratique</h2> <p>Ajoutons un <strong>Bouton d'installation</strong> à notre PWA en procédant comme suit:</p> <ul><li>Définissez la propriété [prefer_related_applications] (https://developers.google.com/web/fundamentals/app-install-banners/native#prefer_related_applications) sur <code>false</code> dans le fichier manifeste.</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;prefer_related_applications&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Ajouter un bouton masqué par défaut et qui servira à afficher l'invite.</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>setup_button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>installApp()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Installer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#setup_button</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Dans le JavaScript principal, intercepter l'évènement <code>beforeinstallprompt</code> qui est déclenché lorsque la PWA satisfait les critères d'installation. Dans le gestionnaire de l'évènement, on gardera une référence vers son paramètre et on affichera le bouton d'installation.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> deferredPrompt<span class="token punctuation">;</span> <span class="token comment">// Allows to show the install prompt</span>
<span class="token keyword">let</span> setupButton<span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeinstallprompt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prevent Chrome 67 and earlier from automatically showing the prompt</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Stash the event so it can be triggered later.</span>
    deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeinstallprompt fired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>setupButton <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        setupButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;setup_button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Show the setup button</span>
    setupButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;inline&quot;</span><span class="token punctuation">;</span>
    setupButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>La fonction <code>installApp()</code> qui est lancée suite au clic sur le bouton, affiche l'invite d'installation en utilisant la référence récupérée dans le <code>beforeinstallprompt</code>.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">installApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Show the prompt</span>
    deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    setupButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Wait for the user to respond to the prompt</span>
    deferredPrompt<span class="token punctuation">.</span>userChoice
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">'accepted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PWA setup accepted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// hide our user interface that shows our A2HS button</span>
                setupButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PWA setup rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Optionnellement, on peut être avertis de la fin de l'installation.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'appinstalled'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;appinstalled fired&quot;</span><span class="token punctuation">,</span> evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Il est maintenant temps de tester !.
N'hésitez pas à forcer un nettoyage du cache.
Sur macOS, le raccourci est <strong>⇧⌘R</strong></p> <p><img src="/assets/img/pwa_setup_button.1a13ee70.png" alt="PWA install button"> <img src="/assets/img/pwa_setup_prompt.4b3c7ae2.png" alt="PWA install prompt"></p> <p>La PWA lancée en mode standalone sur macOS ressemble à cela:</p> <p><img src="/assets/img/pwa_installed.7df4c154.png" alt="PWA installed"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fr/5-background-sync/" class="prev">5. Background sync et notifications</a></span> <span class="next"><a href="/fr/finish.html">Pour aller plus loin</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d9dc9a76.js" defer></script><script src="/assets/js/3.c69d9a44.js" defer></script><script src="/assets/js/10.4a2f255d.js" defer></script>
  </body>
</html>
